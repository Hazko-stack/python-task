<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  id="Definitions_Revenue_BeeCycle"
                  targetNamespace="http://example.com/bpmn/revenue_beecycle">

  <!-- Collaboration: two pools (Participants) -->
  <bpmn:collaboration id="Collaboration_Revenue">
    <bpmn:participant id="Participant_BeeCycle" name="BEECYCLE" processRef="Process_BeeCycle"/>
    <bpmn:participant id="Participant_Customer" name="Pelanggan" processRef="Process_Customer"/>

    <!-- Message flows between pools -->
    <bpmn:messageFlow id="MF_PO_to_Sales" name="Purchase Order" sourceRef="Task_Customer_SendPO" targetRef="Task_Sales_ReceivePO"/>
    <bpmn:messageFlow id="MF_Shipping_to_Customer" name="Ship goods & docs" sourceRef="Task_Shipping_SendGoods" targetRef="Task_Customer_ReceiveGoods"/>
    <bpmn:messageFlow id="MF_Customer_ReturnSignedSN" name="Return signed Shipping Notice" sourceRef="Task_Customer_SignShippingNotice" targetRef="Task_Shipping_ReceiveSignedSN"/>
    <bpmn:messageFlow id="MF_Invoice_to_Customer" name="Invoice" sourceRef="Task_Finance_SendInvoice" targetRef="Task_Customer_ReceiveInvoice"/>
    <bpmn:messageFlow id="MF_Remittance_to_Finance" name="Remittance Advice" sourceRef="Task_Customer_SendRemittance" targetRef="Task_Finance_ReceiveRemittance"/>
    <bpmn:messageFlow id="MF_Receipt_to_Customer" name="Receipt" sourceRef="Task_Finance_SendReceipt" targetRef="Task_Customer_ReceiveReceipt"/>
  </bpmn:collaboration>

  <!-- Process: Customer (external) -->
  <bpmn:process id="Process_Customer" isExecutable="false" name="Customer Process">
    <bpmn:startEvent id="Start_Customer" name="Start"/>
    <bpmn:userTask id="Task_Customer_SendPO" name="Kirim Purchase Order (PO)"/>
    <bpmn:sequenceFlow id="flow_c_1" sourceRef="Start_Customer" targetRef="Task_Customer_SendPO"/>

    <bpmn:userTask id="Task_Customer_ReceiveGoods" name="Terima barang & dokumen"/>
    <bpmn:sequenceFlow id="flow_c_2" sourceRef="Task_Customer_SendPO" targetRef="Task_Customer_ReceiveGoods"/>

    <!-- combine check & sign into single user task per discussion -->
    <bpmn:userTask id="Task_Customer_SignShippingNotice" name="Periksa barang dan tanda tangani Shipping Notice"/>
    <bpmn:sequenceFlow id="flow_c_3" sourceRef="Task_Customer_ReceiveGoods" targetRef="Task_Customer_SignShippingNotice"/>

    <bpmn:userTask id="Task_Customer_ReceiveInvoice" name="Terima Invoice"/>
    <bpmn:sequenceFlow id="flow_c_4" sourceRef="Task_Customer_SignShippingNotice" targetRef="Task_Customer_ReceiveInvoice"/>

    <bpmn:userTask id="Task_Customer_MakePayment" name="Lakukan pembayaran"/>
    <bpmn:sequenceFlow id="flow_c_5" sourceRef="Task_Customer_ReceiveInvoice" targetRef="Task_Customer_MakePayment"/>

    <bpmn:userTask id="Task_Customer_SendRemittance" name="Kirim Remittance Advice (bukti bayar)"/>
    <bpmn:sequenceFlow id="flow_c_6" sourceRef="Task_Customer_MakePayment" targetRef="Task_Customer_SendRemittance"/>

    <bpmn:userTask id="Task_Customer_ReceiveReceipt" name="Terima Kuitansi (Receipt)"/>
    <bpmn:sequenceFlow id="flow_c_7" sourceRef="Task_Customer_SendRemittance" targetRef="Task_Customer_ReceiveReceipt"/>

    <bpmn:endEvent id="End_Customer" name="End"/>
    <bpmn:sequenceFlow id="flow_c_8" sourceRef="Task_Customer_ReceiveReceipt" targetRef="End_Customer"/>
  </bpmn:process>

  <!-- Process: BEECYCLE (internal) with Lanes -->
  <bpmn:process id="Process_BeeCycle" isExecutable="true" name="BEECYCLE Revenue Process">
    <!-- Lanes -->
    <bpmn:laneSet id="LaneSet_BeeCycle">
      <bpmn:lane id="Lane_Sales" name="Sales">
        <bpmn:flowNodeRef>Task_Sales_ReceivePO</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Sales_CreateSO</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Sales_PrintSO</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_Warehouse" name="Warehouse">
        <bpmn:flowNodeRef>Task_Warehouse_ReceiveSO</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Warehouse_CreatePicking</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Warehouse_PackAndCreateShippingNotice</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_Shipping" name="Shipping">
        <bpmn:flowNodeRef>Task_Shipping_ReceiveShipment</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Shipping_SendGoods</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Shipping_ReceiveSignedSN</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Shipping_ForwardsSNtoFinance</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_Finance" name="Finance">
        <bpmn:flowNodeRef>Task_Finance_ReceiveDocs</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Finance_CreateInvoice</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Finance_SendInvoice</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Finance_ReceiveRemittance</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Finance_CreateReceipt</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Task_Finance_SendReceipt</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>

    <!-- Start event -->
    <bpmn:startEvent id="Start_BeeCycle" name="Start"/>
    <bpmn:sequenceFlow id="flow_1" sourceRef="Start_BeeCycle" targetRef="Task_Sales_ReceivePO"/>

    <!-- Sales -->
    <bpmn:userTask id="Task_Sales_ReceivePO" name="Terima Purchase Order (PO)"/>
    <bpmn:sequenceFlow id="flow_2" sourceRef="Task_Sales_ReceivePO" targetRef="Task_Sales_CreateSO"/>

    <bpmn:userTask id="Task_Sales_CreateSO" name="Buat Sales Order (SO)"/>
    <!-- system task: simpan SO ke data store -->
    <bpmn:serviceTask id="Task_Sales_SaveSO" name="Simpan SO ke Data Store" implementation="##internal"/>
    <bpmn:sequenceFlow id="flow_3" sourceRef="Task_Sales_CreateSO" targetRef="Task_Sales_SaveSO"/>
    <bpmn:sequenceFlow id="flow_4" sourceRef="Task_Sales_SaveSO" targetRef="Task_Sales_PrintSO"/>

    <!-- parallel split: print/distribute SO (3 outputs logically) -->
    <bpmn:parallelGateway id="Gateway_Sales_DistributeSO" name="Distribusi SO (Parallel)"/>
    <bpmn:sequenceFlow id="flow_5" sourceRef="Task_Sales_PrintSO" targetRef="Gateway_Sales_DistributeSO"/>

    <bpmn:userTask id="Task_Sales_PrintSO" name="Cetak SO (3 rangkap)"/>
    <!-- three outgoing flows (in process we route to warehouse, finance and continue) -->
    <bpmn:sequenceFlow id="flow_6" sourceRef="Gateway_Sales_DistributeSO" targetRef="Task_Warehouse_ReceiveSO"/>
    <bpmn:sequenceFlow id="flow_7" sourceRef="Gateway_Sales_DistributeSO" targetRef="Task_Finance_ReceiveDocs"/>
    <bpmn:sequenceFlow id="flow_8" sourceRef="Gateway_Sales_DistributeSO" targetRef="Task_Sales_EndBranch"/>

    <!-- Dummy task to close third branch -->
    <bpmn:task id="Task_Sales_EndBranch" name="SO to Archive (implicit)"/>
    <bpmn:sequenceFlow id="flow_9" sourceRef="Task_Sales_EndBranch" targetRef="Task_Warehouse_ReceiveSO" />

    <!-- Warehouse -->
    <bpmn:userTask id="Task_Warehouse_ReceiveSO" name="Terima SO (dari Sales)"/>
    <bpmn:sequenceFlow id="flow_10" sourceRef="Task_Warehouse_ReceiveSO" targetRef="Task_Warehouse_CreatePicking"/>

    <bpmn:userTask id="Task_Warehouse_CreatePicking" name="Buat Picking List"/>
    <bpmn:serviceTask id="Task_Warehouse_SavePicking" name="Simpan Picking List" implementation="##internal"/>
    <bpmn:sequenceFlow id="flow_11" sourceRef="Task_Warehouse_CreatePicking" targetRef="Task_Warehouse_SavePicking"/>
    <bpmn:sequenceFlow id="flow_12" sourceRef="Task_Warehouse_SavePicking" targetRef="Task_Warehouse_PackAndCreateShippingNotice"/>

    <bpmn:userTask id="Task_Warehouse_PackAndCreateShippingNotice" name="Ambil, kemas & buat Shipping Notice"/>
    <bpmn:serviceTask id="Task_Warehouse_SaveSN" name="Simpan Shipping Notice" implementation="##internal"/>
    <bpmn:sequenceFlow id="flow_13" sourceRef="Task_Warehouse_PackAndCreateShippingNotice" targetRef="Task_Warehouse_SaveSN"/>
    <bpmn:sequenceFlow id="flow_14" sourceRef="Task_Warehouse_SaveSN" targetRef="Gateway_Warehouse_DistributeSN"/>

    <!-- parallel gateway: Shipping Notice -> Shipping (send) and internal store (already saved by serviceTask) -->
    <bpmn:parallelGateway id="Gateway_Warehouse_DistributeSN"/>
    <bpmn:sequenceFlow id="flow_15" sourceRef="Gateway_Warehouse_DistributeSN" targetRef="Task_Shipping_ReceiveShipment"/>

    <!-- Shipping -->
    <bpmn:userTask id="Task_Shipping_ReceiveShipment" name="Terima sepeda & Shipping Notice (dari Warehouse)"/>
    <bpmn:sequenceFlow id="flow_16" sourceRef="Task_Shipping_ReceiveShipment" targetRef="Task_Shipping_SendGoods"/>

    <bpmn:userTask id="Task_Shipping_SendGoods" name="Kirim barang + Goods Packing Slip + Shipping Notice"/>
    <!-- message flow to Customer (defined in collaboration) -->
    <bpmn:sequenceFlow id="flow_17" sourceRef="Task_Shipping_SendGoods" targetRef="Task_Shipping_WaitForSignedSN"/>

    <!-- wait for signed shipping notice: exclusive gateway to model conditional continuation -->
    <bpmn:exclusiveGateway id="Gateway_Shipping_WaitSigned" name="Shipping Notice ditandatangani?"/>
    <bpmn:task id="Task_Shipping_WaitForSignedSN" name="Menunggu Shipping Notice yang ditandatangani"/>
    <bpmn:sequenceFlow id="flow_18" sourceRef="Task_Shipping_WaitForSignedSN" targetRef="Gateway_Shipping_WaitSigned"/>

    <bpmn:sequenceFlow id="flow_19" sourceRef="Gateway_Shipping_WaitSigned" targetRef="Task_Shipping_ReceiveSignedSN">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression"><![CDATA[Signed == true]]></bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="flow_20" sourceRef="Gateway_Shipping_WaitSigned" targetRef="Task_Shipping_WaitForSignedSN">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression"><![CDATA[Signed == false]]></bpmn:conditionExpression>
    </bpmn:sequenceFlow>

    <bpmn:userTask id="Task_Shipping_ReceiveSignedSN" name="Terima Shipping Notice yang sudah ditandatangani (dari Pelanggan)"/>
    <bpmn:sequenceFlow id="flow_21" sourceRef="Task_Shipping_ReceiveSignedSN" targetRef="Task_Shipping_ForwardsSNtoFinance"/>

    <bpmn:serviceTask id="Task_Shipping_ForwardsSNtoFinance" name="Serahkan Shipping Notice ke Finance" implementation="##internal"/>
    <bpmn:sequenceFlow id="flow_22" sourceRef="Task_Shipping_ForwardsSNtoFinance" targetRef="Task_Finance_ReceiveDocs"/>

    <!-- Finance -->
    <bpmn:userTask id="Task_Finance_ReceiveDocs" name="Terima SO dan Shipping Notice"/>
    <!-- join SO and Shipping Notice logically - we used sequence flows to route here -->
    <bpmn:sequenceFlow id="flow_23" sourceRef="Task_Finance_ReceiveDocs" targetRef="Task_Finance_CreateInvoice"/>

    <bpmn:serviceTask id="Task_Finance_CreateInvoice" name="Buat Invoice & Simpan" implementation="##internal"/>
    <bpmn:sequenceFlow id="flow_24" sourceRef="Task_Finance_CreateInvoice" targetRef="Task_Finance_SendInvoice"/>

    <bpmn:serviceTask id="Task_Finance_SendInvoice" name="Kirim Invoice ke Pelanggan" implementation="##internal"/>
    <bpmn:sequenceFlow id="flow_25" sourceRef="Task_Finance_SendInvoice" targetRef="Task_Finance_WaitRemit"/>

    <bpmn:task id="Task_Finance_WaitRemit" name="Menunggu Remittance Advice (bukti bayar)"/>
    <bpmn:sequenceFlow id="flow_26" sourceRef="Task_Finance_WaitRemit" targetRef="Gateway_Finance_CheckPayment"/>

    <bpmn:exclusiveGateway id="Gateway_Finance_CheckPayment" name="Pembayaran diterima?"/>
    <bpmn:sequenceFlow id="flow_27" sourceRef="Gateway_Finance_CheckPayment" targetRef="Task_Finance_ReceiveRemittance">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression"><![CDATA[Paid == true]]></bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="flow_28" sourceRef="Gateway_Finance_CheckPayment" targetRef="Task_Finance_WaitRemit">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression"><![CDATA[Paid == false]]></bpmn:conditionExpression>
    </bpmn:sequenceFlow>

    <bpmn:serviceTask id="Task_Finance_ReceiveRemittance" name="Terima Remittance Advice (verifikasi)" implementation="##internal"/>
    <bpmn:sequenceFlow id="flow_29" sourceRef="Task_Finance_ReceiveRemittance" targetRef="Task_Finance_CreateReceipt"/>

    <bpmn:serviceTask id="Task_Finance_CreateReceipt" name="Buat Kuitansi & Simpan" implementation="##internal"/>
    <bpmn:sequenceFlow id="flow_30" sourceRef="Task_Finance_CreateReceipt" targetRef="Task_Finance_SendReceipt"/>

    <bpmn:serviceTask id="Task_Finance_SendReceipt" name="Kirim Kuitansi ke Pelanggan" implementation="##internal"/>
    <bpmn:sequenceFlow id="flow_31" sourceRef="Task_Finance_SendReceipt" targetRef="End_BeeCycle"/>

    <bpmn:endEvent id="End_BeeCycle" name="End"/>
  </bpmn:process>

  <!-- BPMNDiagram / BPMNPlane minimal (diagram info optional for demo editors) -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_Revenue">
    <bpmndi:BPMNPlane id="BPMNPlane_Revenue" bpmnElement="Collaboration_Revenue"/>
    <!-- Note: diagram positioning (BPMNShape/BPMNEdge) omitted for brevity - most editors render from model -->
  </bpmndi:BPMNDiagram>

</bpmn:definitions>
